<html>

<head>
    <title>Meine tolle Seite</title>
</head>

<body>
    <div style="height:1000px;width:1000px;position:relative">
        <canvas width="1000px" height="1000px" id="my-canvas"
            style='position:absolute;top:0;left:0;z-index: 1;'></canvas>
        <canvas width="1000px" height="1000px" id="my-overlay"
            style='position:absolute;top:0;left:0;z-index: 2;'></canvas>
    </div>
    <div>
        <button type="button" onclick="clearOverlay()">Reset</button>
    </div>
</body>
<script type="text/javascript">

    const myCanvas = document.getElementById("my-canvas")
    const ctx = myCanvas.getContext('2d');
    const myOverlay = document.getElementById("my-overlay")
    const ovl = myOverlay.getContext('2d');
    const servo1_pos = { x: 190, y: 50 }
    const servo2_pos = { x: 810, y: 50 }
    const length_arm_b = 350;
    const length_arm_a = 400;
    const COLOR_RED = 'red';
    const COLOR_GREEN = 'green';
    const NEUNZIG_GRAD = Math.PI / 2;

    var pos_stift = { x: 190, y: 550 }

    String.prototype.format = function () {
        a = this;
        for (k in arguments) {
            a = a.replace("{" + k + "}", arguments[k])
        }
        return a
    }

    function degToRad(angle) {
        return angle * Math.PI / 180;
    }

    function drawDotOnCanvas(ctx, point, size) {
        ctx.beginPath();
        ctx.fillStyle = 'black';
        ctx.arc(point.x, point.y, size / 2, degToRad(0), degToRad(359), false);
        ctx.fill();
    }

    function drawDot(point, size) {
        drawDotOnCanvas(ctx, point, size);
    }

    function drawDotOnOverlay(point, size) {
        drawDotOnCanvas(ovl, point, size);
    }

    function clearOverlay() {
        ovl.clearRect(0, 0, myOverlay.width, myOverlay.height);
    }

    function drawServo(servo_pos) {
        ctx.fillStyle = 'green';
        ctx.fillRect(servo_pos.x - 90, servo_pos.y - 40, 180, 80);
        ctx.fillStyle = 'black';
        drawDot(servo_pos, 10);
    }

    function drawRect(pos, size) {
        ctx.fillStyle = '#e0ff20';
        ctx.fillRect(pos.x, pos.y, size.x, size.y);
    }

    function drawArm(start, ende, farbe) {
        const armWidth = 20;
        drawDot(start, armWidth);
        ctx.beginPath();
        ctx.moveTo(start.x, start.y);
        ctx.lineWidth = armWidth;
        ctx.lineTo(ende.x, ende.y);
        ctx.strokeStyle = farbe;
        ctx.stroke();
        drawDot(ende, armWidth);
    }


    function drawCanvas() {
        ctx.fillStyle = '#ffc000';
        ctx.fillRect(0, 0, 1000, 1000);

        drawServo(servo1_pos);
        drawServo(servo2_pos);
    }

    function draw_line_by_angle(starting_point, angle, length, farbe) {
        a = length * Math.sin(angle);
        b = length * Math.cos(angle);
        ende_x = starting_point.x + b;
        ende_y = starting_point.y + a;
        ende = { x: ende_x, y: ende_y };



        drawArm(starting_point, ende, farbe);//
    }

    function draw_two_lines_left(from, to) {
        var DR = to.y - from.y;
        var AR = to.x - from.x;
        var AD = Math.sqrt(AR * AR + DR * DR);
        var r1 = (Math.asin(DR / AD));
        var w1 = Math.acos(
            (length_arm_a ** 2 + AD ** 2 - length_arm_b ** 2)
            / (2 * length_arm_a * AD)
        ); // Kosinussatz
        var alpha = (r1 + w1);
        if (AR < 0) {
            alpha = (NEUNZIG_GRAD * 2 - r1) + w1
        }
        //var w2 = Math.asin(AD / length_arm_a);
        var w2 = Math.acos(
            (length_arm_a ** 2 + length_arm_b ** 2 - AD ** 2)
            / (2 * length_arm_b * length_arm_a)
        ); // Kosinussatz
        var beta2 = Math.PI - alpha;
        var beta3 = NEUNZIG_GRAD - beta2;
        var AF = length_arm_a * Math.cos(beta2);

        var FE = Math.sqrt(length_arm_a * length_arm_a - AF * AF);
        if (alpha > 2 * NEUNZIG_GRAD) {
            FE = -FE;
        }
        var gelenk = { x: from.x - AF, y: from.y + FE };

        draw_line_by_angle(from, alpha, length_arm_a, COLOR_RED);
        drawDot(gelenk, 30);
        draw_line_by_angle(gelenk, w2 + beta3 - NEUNZIG_GRAD, length_arm_b, COLOR_GREEN);

        return alpha;
    }

    // Zweiter Arm

    //draw_two_lines_left(servo2_pos, mouse_position);


    /*  function draw_two_lines(from, to, seite) {
  
          console.log(seite);
  
          var DR = to.y - from.y; //check
          var AR = (from.x) - to.x; //check
          var AD = Math.sqrt(AR * AR + DR * DR); //check     
          var r1 = Math.atan(DR / AR); //check außer rechts von servo2_pos
          var w1 = Math.acos(
              (length_arm_a ** 2 + AD ** 2 - length_arm_b ** 2)
              / (2 * length_arm_a * AD)
          ); // Kosinussatz
          if (seite = 2) {
              var alpha = 2 * NEUNZIG_GRAD - (r1 + w1);
              if (AR < 0) {
                  alpha = alpha - 2 * NEUNZIG_GRAD;
              }
              else {
                  var alpha = (r1 + w1);
                  if (AR < 0) {
                      alpha = (NEUNZIG_GRAD * 2 - r1) + w1
                  }
              }
          }
  
          //var w2 = Math.asin(AD / length_arm_a);
          var w2 = Math.acos(
              (length_arm_a ** 2 + length_arm_b ** 2 - AD ** 2)
              / (2 * length_arm_b * length_arm_a)
          ); // Kosinussatz
          var beta2 = Math.PI - alpha;
          var beta3 = NEUNZIG_GRAD - beta2;
          var AF = length_arm_a * Math.cos(beta2);
          if (seite = 2) {
              if (AF < 0) {
                  gelenk = { x: from.x + AF, y: from.y + FE };
              }
          }
  
          var FE = Math.sqrt(length_arm_a * length_arm_a - AF * AF);
          if (seite = 2) {
              if (alpha < 0) {
                  FE = -FE;
              }
          }
  
          if (seite = 1) {
              if (alpha > 2 * NEUNZIG_GRAD) {
                  FE = -FE;
              }
  
  
              var gelenk = { x: from.x - AF, y: from.y + FE };
              draw_line_by_angle(from, alpha, length_arm_a, COLOR_RED);
  
              //        console.log("from.x: {0}, from.y: {1}, DR: {2}, AR: {3}, AD: {4}, w2: {5}"
              //            .format(from.x, from.y, DR, AR, AD, w2));
              console.log(alpha);
          }
  
          drawDot(gelenk, 30);
          if (seite = 2) {
              draw_line_by_angle(gelenk, -w2 + beta3 - NEUNZIG_GRAD, length_arm_b, COLOR_GREEN);
  
          }
          else {
              draw_line_by_angle(gelenk, w2 + beta3 - NEUNZIG_GRAD, length_arm_b, COLOR_GREEN);
          }
  
          draw_line_by_angle(gelenk, -w2 + beta3 - NEUNZIG_GRAD, length_arm_b, COLOR_GREEN);
       //   
       console.log(gelenk)
      }*/

    function draw_two_lines_left(from, to, seite) {
        if (seite = left){
            
        }
        var DR = to.y - from.y;
        var AR = to.x - from.x;
        var AD = Math.sqrt(AR * AR + DR * DR);
        var r1 = (Math.asin(DR / AD));
        var w1 = Math.acos(
            (length_arm_a ** 2 + AD ** 2 - length_arm_b ** 2)
            / (2 * length_arm_a * AD)
        ); // Kosinussatz
        var alpha = (r1 + w1);
        if (AR < 0) {
            alpha = (NEUNZIG_GRAD * 2 - r1) + w1
        }
        //var w2 = Math.asin(AD / length_arm_a);
        var w2 = Math.acos(
            (length_arm_a ** 2 + length_arm_b ** 2 - AD ** 2)
            / (2 * length_arm_b * length_arm_a)
        ); // Kosinussatz
        var beta2 = Math.PI - alpha;
        var beta3 = NEUNZIG_GRAD - beta2;
        var AF = length_arm_a * Math.cos(beta2);

        var FE = Math.sqrt(length_arm_a * length_arm_a - AF * AF);
        if (alpha > 2 * NEUNZIG_GRAD) {
            FE = -FE;
        }
        var gelenk = { x: from.x - AF, y: from.y + FE };

        draw_line_by_angle(from, alpha, length_arm_a, COLOR_RED);
        drawDot(gelenk, 30);
        draw_line_by_angle(gelenk, w2 + beta3 - NEUNZIG_GRAD, length_arm_b, COLOR_GREEN);
        drawDotOnOverlay(to, 30);
        console.log(alpha)
    }

    // Zweiter Arm

    //draw_two_lines_left(servo2_pos, mouse_position);


    function draw_two_lines_right(from, to) {

        var DR = to.y - from.y; //check
        var BR = (from.x) - to.x; //check
        var BD = Math.sqrt(BR * BR + DR * DR); //check     
        var r1 = Math.atan(DR / BR); //check außer rechts von servo2_pos
        var w1 = Math.acos(
            (length_arm_a ** 2 + BD ** 2 - length_arm_b ** 2)
            / (2 * length_arm_a * BD)
        ); // Kosinussatz
        var beta = 2 * NEUNZIG_GRAD - (r1 + w1);
        if (BR < 0) {
            beta = beta - 2 * NEUNZIG_GRAD;
        }
        //var w2 = Math.asin(AD / length_arm_a);
        var w2 = Math.acos(
            (length_arm_a ** 2 + length_arm_b ** 2 - BD ** 2)
            / (2 * length_arm_b * length_arm_a)
        ); // Kosinussatz
        var beta2 = Math.PI - beta;
        var beta3 = NEUNZIG_GRAD - beta2;
        var AF = length_arm_a * Math.cos(beta2);
        if (AF < 0) {
            gelenk = { x: from.x + AF, y: from.y + FE };
        }
        var FE = Math.sqrt(length_arm_a * length_arm_a - AF * AF);
        if (beta < 0) {
            FE = -FE;
        }
        var gelenk = { x: from.x - AF, y: from.y + FE };
        draw_line_by_angle(from, beta, length_arm_a, COLOR_RED);

        //        console.log("from.x: {0}, from.y: {1}, DR: {2}, AR: {3}, AD: {4}, w2: {5}"
        //            .format(from.x, from.y, DR, AR, AD, w2));
        console.log(beta);
        drawDotOnOverlay(to, 30);
        drawDot(gelenk, 30);
        draw_line_by_angle(gelenk, -w2 + beta3 - NEUNZIG_GRAD, length_arm_b, COLOR_GREEN);
    }




    function followMouse(event) {
        var rect = this.getBoundingClientRect(),
            mouse_position = {
                x: event.clientX - rect.left,
                y: event.clientY - rect.top
            };

        drawCanvas();
        drawRect({ x: 150, y: 250 }, { x: 650, y: 300 });
        /* if(mouse_position.x <= 500){
             seite = 1;
         }
         else{
                 seite = 2;
             }*/


        draw_two_lines_left(servo1_pos, mouse_position);
        draw_two_lines_right(servo2_pos, mouse_position);



    }



    // initialization

    // main program

    drawCanvas();

    clearOverlay();

    // var mouse_pos = { x: 400, y: 300 }
    // draw_two_lines(servo1_pos, mouse_pos);

    draw_line_by_angle(servo1_pos, Math.PI / 4, 200);

    myOverlay.onmousemove = followMouse;



</script>

</html>